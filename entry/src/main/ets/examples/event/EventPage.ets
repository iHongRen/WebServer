import { BusinessError } from '@kit.BasicServicesKit';
import { common } from '@kit.AbilityKit';
import { ServerInfo } from '@cxy/webserver';

// import { EventExample } from './EventExample';

@Builder
function eventBuilder() {
  EventPage()
}

@Component
struct EventPage {
  build() {

  }

  // @State title: string = 'Eventç¤ºä¾‹'
  // @State eventExample: EventExample | null = null;
  // @State serverInfo: ServerInfo | null = null;
  // @State port: number = 8084;
  // @State errorMessage: string = '';
  // @State successMessage: string = '';
  // @State eventCount: number = 0;
  //
  // aboutToAppear() {
  //   setTimeout(() => {
  //     this.startServer();
  //   }, 0);
  // }
  //
  // aboutToDisappear() {
  //   this.stopServer();
  // }
  //
  // /**
  //  * åˆå§‹åŒ–Eventç¤ºä¾‹
  //  */
  // async initializeExample() {
  //   this.errorMessage = '';
  //   const context = this.getUIContext().getHostContext() as common.UIAbilityContext;
  //   this.eventExample = new EventExample(context, {
  //     port: this.port,
  //     enableLogging: true,
  //     enableCors: true,
  //     eventHistoryLimit: 1000
  //   });
  //   await this.eventExample.setupStaticFiles();
  // }
  //
  // /**
  //  * å¯åŠ¨æœåŠ¡å™¨
  //  */
  // async startServer() {
  //   if (!this.eventExample) {
  //     await this.initializeExample();
  //   }
  //
  //   if (!this.eventExample) {
  //     this.errorMessage = 'EventæœåŠ¡å™¨åˆå§‹åŒ–å¤±è´¥';
  //     return;
  //   }
  //
  //   try {
  //     this.errorMessage = '';
  //
  //     const info = await this.eventExample.start();
  //
  //     if (info) {
  //       this.serverInfo = info;
  //       this.successMessage = `ðŸ“¡ EventæœåŠ¡å™¨è¿è¡Œä¸­`;
  //       this.startStatsUpdate();
  //     } else {
  //       this.errorMessage = 'EventæœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæœªèŽ·å–åˆ°åœ°å€';
  //     }
  //   } catch (error) {
  //     const businessError = error as BusinessError;
  //     this.errorMessage = `å¯åŠ¨å¤±è´¥: ${businessError.message}`;
  //   }
  // }
  //
  // /**
  //  * åœæ­¢æœåŠ¡å™¨
  //  */
  // async stopServer() {
  //   if (!this.eventExample) {
  //     return;
  //   }
  //
  //   try {
  //     await this.eventExample.stop();
  //
  //     this.eventExample = null;
  //     this.serverInfo = null;
  //     this.successMessage = 'ðŸ“¡ EventæœåŠ¡å™¨å·²åœæ­¢';
  //     this.eventCount = 0;
  //
  //   } catch (error) {
  //     this.errorMessage = `åœæ­¢æœåŠ¡å™¨å¤±è´¥: ${error}`;
  //   }
  // }
  //
  // /**
  //  * å¯åŠ¨ç»Ÿè®¡æ•°æ®æ›´æ–°
  //  */
  // startStatsUpdate() {
  //   const updateStats = () => {
  //     if (this.eventExample) {
  //       this.eventCount = this.eventExample.getEventCount();
  //     }
  //   };
  //
  //   updateStats();
  //   setInterval(updateStats, 2000);
  // }
  //
  // /**
  //  * æ›´æ–°ç«¯å£å·
  //  */
  // updatePort(newPort: string) {
  //   const portNum = parseInt(newPort);
  //   if (portNum > 0 && portNum <= 65535) {
  //     this.port = portNum;
  //     this.errorMessage = '';
  //   } else {
  //     this.errorMessage = 'ç«¯å£å·å¿…é¡»åœ¨1-65535ä¹‹é—´';
  //   }
  // }
  //
  // /**
  //  * æ¸…é™¤æ¶ˆæ¯
  //  */
  // clearMessages() {
  //   this.errorMessage = '';
  //   this.successMessage = '';
  // }
  //
  // build() {
  //   NavDestination() {
  //     Column() {
  //       // æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ
  //       if (this.errorMessage) {
  //         Text(this.errorMessage)
  //           .fontColor(Color.Red)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#ffebee')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       } else if (this.successMessage) {
  //         Text(this.successMessage)
  //           .fontColor(Color.Green)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#e8f5e8')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       }
  //
  //       // æœåŠ¡å™¨çŠ¶æ€åŒºåŸŸ
  //       if (this.serverInfo) {
  //         Column({ space: 15 }) {
  //           // æœåŠ¡å™¨ä¿¡æ¯å¡ç‰‡
  //           Column({ space: 10 }) {
  //             Row() {
  //               Text('ðŸ“¡ EventæœåŠ¡åœ°å€:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(`http://${this.serverInfo.address}:${this.serverInfo.port}`)
  //                 .fontColor(Color.Blue)
  //                 .fontSize(16)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //
  //             Row() {
  //               Text('ç›‘æŽ§é¡µé¢:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(`/event-monitor.html`)
  //                 .fontSize(14)
  //                 .fontColor(Color.Blue)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f0f8ff')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // äº‹ä»¶ç»Ÿè®¡
  //           Column({ space: 10 }) {
  //             Text('ðŸ“Š äº‹ä»¶ç»Ÿè®¡')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Row() {
  //               Text('äº‹ä»¶æ€»æ•°:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(80)
  //               Text(this.eventCount.toString())
  //                 .fontSize(16)
  //                 .fontColor(Color.Blue)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f0fff0')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // äº‹ä»¶ç³»ç»Ÿç‰¹æ€§
  //           Column({ space: 8 }) {
  //             Text('ðŸ“¡ äº‹ä»¶ç³»ç»Ÿç‰¹æ€§')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Text('âœ… æœåŠ¡å™¨äº‹ä»¶ç›‘å¬')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… é”™è¯¯äº‹ä»¶æ•èŽ·')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… å®¢æˆ·ç«¯è¿žæŽ¥äº‹ä»¶')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… è‡ªå®šä¹‰äº‹ä»¶è§¦å‘')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… äº‹ä»¶åŽ†å²è®°å½•')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… å®žæ—¶äº‹ä»¶ç›‘æŽ§')
  //               .fontSize(12)
  //               .fontColor('#666')
  //           }
  //           .alignItems(HorizontalAlign.Start)
  //           .padding(15)
  //           .backgroundColor('#fff3e0')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // åœæ­¢æŒ‰é’®
  //           Button('åœæ­¢EventæœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor('#d32f2f')
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.stopServer();
  //             })
  //         }
  //         .width('100%')
  //
  //       } else {
  //         // æœåŠ¡å™¨æœªè¿è¡ŒçŠ¶æ€
  //         Column({ space: 20 }) {
  //           // é…ç½®åŒºåŸŸ
  //           Row() {
  //             Text('ç«¯å£å·:')
  //               .fontWeight(FontWeight.Medium)
  //               .width(80)
  //             TextInput({
  //               text: this.port.toString(),
  //               placeholder: 'è¯·è¾“å…¥ç«¯å£å· (1-65535)'
  //             })
  //               .type(InputType.Number)
  //               .layoutWeight(1)
  //               .height(40)
  //               .onChange((value) => {
  //                 this.updatePort(value);
  //               })
  //           }
  //           .padding(15)
  //           .backgroundColor('#f5f5f5')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // åŠŸèƒ½è¯´æ˜Ž
  //           Column({ space: 8 }) {
  //             Text('ðŸ“¡ Eventç³»ç»ŸåŠŸèƒ½')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Text('ðŸŽ¯ äº‹ä»¶ç›‘å¬å’Œè§¦å‘')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ“Š äº‹ä»¶ç»Ÿè®¡åˆ†æž')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ” å®žæ—¶äº‹ä»¶ç›‘æŽ§')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ“ äº‹ä»¶åŽ†å²è®°å½•')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('âš ï¸ é”™è¯¯äº‹ä»¶æ•èŽ·')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ”— å®¢æˆ·ç«¯è¿žæŽ¥è·Ÿè¸ª')
  //               .fontSize(14)
  //               .fontColor('#666')
  //           }
  //           .alignItems(HorizontalAlign.Start)
  //           .padding(15)
  //           .backgroundColor('#e3f2fd')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // å¯åŠ¨æŒ‰é’®
  //           Button('å¯åŠ¨EventæœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor('#1976d2')
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.startServer();
  //             })
  //         }
  //         .width('100%')
  //       }
  //     }
  //     .width('100%')
  //     .height('100%')
  //     .padding(20)
  //     .justifyContent(FlexAlign.Start)
  //   }
  //   .title(this.title)
  //   .onReady((ctx) => {
  //     if (ctx.pathInfo.param) {
  //       this.title = ctx.pathInfo.param as string;
  //     }
  //   })
  // }
}

