# 跨域中间件(CORS)说明

## 概述

CORS (Cross-Origin Resource Sharing) 中间件用于处理跨域资源请求，允许或限制来自不同源的HTTP请求。

## 基本使用

### 快速开始

```typescript
import { WebServer, Cors } from "@cxy/webserver";

const server = new WebServer();

// 启用所有来源的CORS
server.use(Cors.create());

app.get('/api/data', (req, res) => {
  res.json({ message: '可以从任何来源访问' });
});
```

### 自定义配置

```typescript
app.use(Cors.create({
  origin: 'https://example.com', // 只允许来自 example.com 的请求
  methods: ['GET', 'POST'],      // 只允许 GET 和 POST 方法
  allowedHeaders: ['Content-Type', 'Authorization'] // 允许的请求头
}));
```

## 配置选项

- `origin`: `string | string[]  - 配置允许的来源。
  - `string`: 指定单个允许的来源。
  - `string[]`: 指定多个允许的来源。
- `methods`: `string | string[]` - 配置允许的HTTP方法。
- `allowedHeaders`: `string | string[]` - 配置允许的请求头。


## 示例场景

### 场景1: 开放API

如果你的API是公开的，可以允许所有来源的请求。

```typescript
server.use(Cors.create());
```

### 场景2: 单页应用(SPA)

假设你的前端应用部署在 `https://app.example.com`，API服务器在 `https://api.example.com`。

```typescript
server.use(Cors.create({
  origin: 'https://app.example.com'
}));
```

### 场景3: 多个开发环境

在开发过程中，你可能需要允许多个来源，例如本地开发服务器和测试服务器。

```typescript
server.use(Cors.create({
  origin: ['http://your-ip:3000', 'https://dev.example.com']
}));
```

## `curl` 测试用例

### 测试允许所有来源

```bash
# 模拟来自 example.com 的请求
curl -X OPTIONS http://your-ip:8080/cors-all -H "Origin: https://example.com" -v
# 预期响应头中包含: Access-Control-Allow-Origin: *
```

### 测试特定来源

```bash
# 模拟来自允许的来源的请求
curl -X OPTIONS http://your-ip:8080/cors-specific-origin -H "Origin: https://example.com" -v
# 预期响应头中包含: Access-Control-Allow-Origin: https://example.com

# 模拟来自不允许的来源的请求
curl -X OPTIONS http://your-ip:8080/cors-specific-origin -H "Origin: https://disallowed.com" -v
# 预期不会收到 Access-Control-Allow-Origin 头
```
