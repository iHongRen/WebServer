import { BusinessError } from '@kit.BasicServicesKit';
import { common } from '@kit.AbilityKit';
import { ServerInfo } from '@cxy/webserver';

// import { CorsExample } from './CorsExample';

@Builder
function corsBuilder() {
  CorsPage()
}

@Component
struct CorsPage {
  build() {

  }

  // @State title: string = 'CORSç¤ºä¾‹'
  // @State corsExample: CorsExample | null = null;
  // @State serverInfo: ServerInfo | null = null;
  // @State port: number = 8083;
  // @State errorMessage: string = '';
  // @State successMessage: string = '';
  // @State corsRequestCount: number = 0;
  // @State allowAllOrigins: boolean = true;
  //
  // aboutToAppear() {
  //   setTimeout(() => {
  //     this.startServer();
  //   }, 0);
  // }
  //
  // aboutToDisappear() {
  //   this.stopServer();
  // }
  //
  // /**
  //  * åˆå§‹åŒ–CORSç¤ºä¾‹
  //  */
  // async initializeExample() {
  //   this.errorMessage = '';
  //   const context = this.getUIContext().getHostContext() as common.UIAbilityContext;
  //
  //   const corsOrigins = this.allowAllOrigins ? ['*'] : ['http://localhost:3000', 'http://127.0.0.1:3000'];
  //
  //   this.corsExample = new CorsExample(context, {
  //     port: this.port,
  //     enableLogging: true,
  //     corsOrigins: corsOrigins,
  //     corsMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  //     corsHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  //     corsCredentials: true
  //   });
  //   await this.corsExample.setupStaticFiles();
  // }
  //
  // /**
  //  * å¯åŠ¨æœåŠ¡å™¨
  //  */
  // async startServer() {
  //   if (!this.corsExample) {
  //     await this.initializeExample();
  //   }
  //
  //   if (!this.corsExample) {
  //     this.errorMessage = 'CORSæœåŠ¡å™¨åˆå§‹åŒ–å¤±è´¥';
  //     return;
  //   }
  //
  //   try {
  //     this.errorMessage = '';
  //
  //     const info = await this.corsExample.start();
  //
  //     if (info) {
  //       this.serverInfo = info;
  //       this.successMessage = `ðŸŒ CORSæœåŠ¡å™¨è¿è¡Œä¸­`;
  //       this.startStatsUpdate();
  //     } else {
  //       this.errorMessage = 'CORSæœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæœªèŽ·å–åˆ°åœ°å€';
  //     }
  //   } catch (error) {
  //     const businessError = error as BusinessError;
  //     this.errorMessage = `å¯åŠ¨å¤±è´¥: ${businessError.message}`;
  //   }
  // }
  //
  // /**
  //  * åœæ­¢æœåŠ¡å™¨
  //  */
  // async stopServer() {
  //   if (!this.corsExample) {
  //     return;
  //   }
  //
  //   try {
  //     await this.corsExample.stop();
  //
  //     this.corsExample = null;
  //     this.serverInfo = null;
  //     this.successMessage = 'ðŸŒ CORSæœåŠ¡å™¨å·²åœæ­¢';
  //     this.corsRequestCount = 0;
  //
  //   } catch (error) {
  //     this.errorMessage = `åœæ­¢æœåŠ¡å™¨å¤±è´¥: ${error}`;
  //   }
  // }
  //
  // /**
  //  * å¯åŠ¨ç»Ÿè®¡æ•°æ®æ›´æ–°
  //  */
  // startStatsUpdate() {
  //   const updateStats = () => {
  //     if (this.corsExample) {
  //       this.corsRequestCount = this.corsExample.getCorsRequestCount();
  //     }
  //   };
  //
  //   updateStats();
  //   setInterval(updateStats, 3000);
  // }
  //
  // /**
  //  * æ›´æ–°ç«¯å£å·
  //  */
  // updatePort(newPort: string) {
  //   const portNum = parseInt(newPort);
  //   if (portNum > 0 && portNum <= 65535) {
  //     this.port = portNum;
  //     this.errorMessage = '';
  //   } else {
  //     this.errorMessage = 'ç«¯å£å·å¿…é¡»åœ¨1-65535ä¹‹é—´';
  //   }
  // }
  //
  // /**
  //  * æ¸…é™¤æ¶ˆæ¯
  //  */
  // clearMessages() {
  //   this.errorMessage = '';
  //   this.successMessage = '';
  // }
  //
  // build() {
  //   NavDestination() {
  //     Column() {
  //       // æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ
  //       if (this.errorMessage) {
  //         Text(this.errorMessage)
  //           .fontColor(Color.Red)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#ffebee')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       } else if (this.successMessage) {
  //         Text(this.successMessage)
  //           .fontColor(Color.Green)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#e8f5e8')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       }
  //
  //       // æœåŠ¡å™¨çŠ¶æ€åŒºåŸŸ
  //       if (this.serverInfo) {
  //         Column({ space: 15 }) {
  //           // æœåŠ¡å™¨ä¿¡æ¯å¡ç‰‡
  //           Column({ space: 10 }) {
  //             Row() {
  //               Text('ðŸŒ CORSæœåŠ¡åœ°å€:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(`http://${this.serverInfo.address}:${this.serverInfo.port}`)
  //                 .fontColor(Color.Blue)
  //                 .fontSize(16)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //
  //             Row() {
  //               Text('æ¼”ç¤ºé¡µé¢:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(`/cors-demo.html`)
  //                 .fontSize(14)
  //                 .fontColor(Color.Blue)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //
  //             Row() {
  //               Text('CORSç­–ç•¥:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(this.allowAllOrigins ? 'å…è®¸æ‰€æœ‰æ¥æº (*)' : 'é™åˆ¶ç‰¹å®šæ¥æº')
  //                 .fontSize(14)
  //                 .fontColor(this.allowAllOrigins ? Color.Orange : Color.Green)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f0f8ff')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // CORSç»Ÿè®¡
  //           Column({ space: 10 }) {
  //             Text('ðŸ“Š CORSè¯·æ±‚ç»Ÿè®¡')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Row() {
  //               Text('è¯·æ±‚æ¬¡æ•°:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(80)
  //               Text(this.corsRequestCount.toString())
  //                 .fontSize(16)
  //                 .fontColor(Color.Blue)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f0fff0')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // CORSç‰¹æ€§
  //           Column({ space: 8 }) {
  //             Text('ðŸŒ CORSç‰¹æ€§')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Text('âœ… è·¨åŸŸè¯·æ±‚æ”¯æŒ')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… é¢„æ£€è¯·æ±‚å¤„ç†')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… å‡­è¯è¯·æ±‚æ”¯æŒ')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… è‡ªå®šä¹‰å¤´éƒ¨æ”¯æŒ')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… æ¥æºç™½åå•æŽ§åˆ¶')
  //               .fontSize(12)
  //               .fontColor('#666')
  //             Text('âœ… è¯·æ±‚ç»Ÿè®¡åˆ†æž')
  //               .fontSize(12)
  //               .fontColor('#666')
  //           }
  //           .alignItems(HorizontalAlign.Start)
  //           .padding(15)
  //           .backgroundColor('#fff3e0')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // åœæ­¢æŒ‰é’®
  //           Button('åœæ­¢CORSæœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor('#d32f2f')
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.stopServer();
  //             })
  //         }
  //         .width('100%')
  //
  //       } else {
  //         // æœåŠ¡å™¨æœªè¿è¡ŒçŠ¶æ€
  //         Column({ space: 20 }) {
  //           // é…ç½®åŒºåŸŸ
  //           Column({ space: 15 }) {
  //             Text('CORSæœåŠ¡å™¨é…ç½®')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //
  //             Row() {
  //               Text('ç«¯å£å·:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(80)
  //               TextInput({
  //                 text: this.port.toString(),
  //                 placeholder: 'è¯·è¾“å…¥ç«¯å£å· (1-65535)'
  //               })
  //                 .type(InputType.Number)
  //                 .layoutWeight(1)
  //                 .height(40)
  //                 .onChange((value) => {
  //                   this.updatePort(value);
  //                 })
  //             }
  //             .width('100%')
  //
  //             Row() {
  //               Text('CORSç­–ç•¥:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(80)
  //               Row() {
  //                 Radio({ value: 'all', group: 'corsPolicy' })
  //                   .checked(this.allowAllOrigins)
  //                   .onChange((isChecked) => {
  //                     if (isChecked) {
  //                       this.allowAllOrigins = true;
  //                     }
  //                   })
  //                 Text('å…è®¸æ‰€æœ‰æ¥æº')
  //                   .fontSize(14)
  //                   .margin({ left: 5, right: 15 })
  //
  //                 Radio({ value: 'restricted', group: 'corsPolicy' })
  //                   .checked(!this.allowAllOrigins)
  //                   .onChange((isChecked) => {
  //                     if (isChecked) {
  //                       this.allowAllOrigins = false;
  //                     }
  //                   })
  //                 Text('é™åˆ¶æ¥æº')
  //                   .fontSize(14)
  //                   .margin({ left: 5 })
  //               }
  //               .layoutWeight(1)
  //             }
  //             .width('100%')
  //           }
  //           .padding(15)
  //           .backgroundColor('#f5f5f5')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // åŠŸèƒ½è¯´æ˜Ž
  //           Column({ space: 8 }) {
  //             Text('ðŸŒ CORSåŠŸèƒ½')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //               .margin({ bottom: 5 })
  //
  //             Text('ðŸ”„ è·¨åŸŸèµ„æºå…±äº«')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ›¡ï¸ æ¥æºè®¿é—®æŽ§åˆ¶')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ” é¢„æ£€è¯·æ±‚å¤„ç†')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ”‘ å‡­è¯è¯·æ±‚æ”¯æŒ')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ“‹ è‡ªå®šä¹‰å¤´éƒ¨ç®¡ç†')
  //               .fontSize(14)
  //               .fontColor('#666')
  //             Text('ðŸ“Š è¯·æ±‚ç»Ÿè®¡åˆ†æž')
  //               .fontSize(14)
  //               .fontColor('#666')
  //           }
  //           .alignItems(HorizontalAlign.Start)
  //           .padding(15)
  //           .backgroundColor('#e3f2fd')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // å¯åŠ¨æŒ‰é’®
  //           Button('å¯åŠ¨CORSæœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor('#1976d2')
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.startServer();
  //             })
  //         }
  //         .width('100%')
  //       }
  //     }
  //     .width('100%')
  //     .height('100%')
  //     .padding(20)
  //     .justifyContent(FlexAlign.Start)
  //   }
  //   .title(this.title)
  //   .onReady((ctx) => {
  //     if (ctx.pathInfo.param) {
  //       this.title = ctx.pathInfo.param as string;
  //     }
  //   })
  // }
}

