import { BusinessError } from '@kit.BasicServicesKit';
import { common } from '@kit.AbilityKit';
import { ServerInfo } from '@cxy/webserver';

// import { StaticExample } from './StaticExample';

@Builder
function staticBuilder() {
  StaticPage()
}

@Component
struct StaticPage {
  build() {

  }

  // @State title: string = 'Staticç¤ºä¾‹'
  // @State staticExample: StaticExample | null = null;
  // @State serverInfo: ServerInfo | null = null;
  // @State port: number = 8087;
  // @State errorMessage: string = '';
  // @State successMessage: string = '';
  // @State accessCount: number = 0;
  // @State enableCache: boolean = true;
  //
  // aboutToAppear() {
  //   setTimeout(() => {
  //     this.startServer();
  //   }, 0);
  // }
  //
  // aboutToDisappear() {
  //   this.stopServer();
  // }
  //
  // /**
  //  * åˆå§‹åŒ–Staticç¤ºä¾‹
  //  */
  // async initializeExample() {
  //   this.errorMessage = '';
  //   const context = this.getUIContext().getHostContext() as common.UIAbilityContext;
  //   this.staticExample = new StaticExample(context, {
  //     port: this.port,
  //     enableLogging: true,
  //     enableCors: true,
  //     enableCache: this.enableCache,
  //     maxAge: 3600
  //   });
  //   await this.staticExample.setupStaticFiles();
  // }
  //
  // /**
  //  * å¯åŠ¨æœåŠ¡å™¨
  //  */
  // async startServer() {
  //   if (!this.staticExample) {
  //     await this.initializeExample();
  //   }
  //
  //   if (!this.staticExample) {
  //     this.errorMessage = 'StaticæœåŠ¡å™¨åˆå§‹åŒ–å¤±è´¥';
  //     return;
  //   }
  //
  //   try {
  //     this.errorMessage = '';
  //
  //     const info = await this.staticExample.start();
  //
  //     if (info) {
  //       this.serverInfo = info;
  //       this.successMessage = `ðŸ“ StaticæœåŠ¡å™¨è¿è¡Œä¸­`;
  //       this.startStatsUpdate();
  //     } else {
  //       this.errorMessage = 'StaticæœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæœªèŽ·å–åˆ°åœ°å€';
  //     }
  //   } catch (error) {
  //     const businessError = error as BusinessError;
  //     this.errorMessage = `å¯åŠ¨å¤±è´¥: ${businessError.message}`;
  //   }
  // }
  //
  // /**
  //  * åœæ­¢æœåŠ¡å™¨
  //  */
  // async stopServer() {
  //   if (!this.staticExample) {
  //     return;
  //   }
  //
  //   try {
  //     await this.staticExample.stop();
  //
  //     this.staticExample = null;
  //     this.serverInfo = null;
  //     this.successMessage = 'ðŸ“ StaticæœåŠ¡å™¨å·²åœæ­¢';
  //     this.accessCount = 0;
  //
  //   } catch (error) {
  //     this.errorMessage = `åœæ­¢æœåŠ¡å™¨å¤±è´¥: ${error}`;
  //   }
  // }
  //
  // /**
  //  * å¯åŠ¨ç»Ÿè®¡æ•°æ®æ›´æ–°
  //  */
  // startStatsUpdate() {
  //   const updateStats = () => {
  //     if (this.staticExample) {
  //       this.accessCount = this.staticExample.getAccessCount();
  //     }
  //   };
  //
  //   updateStats();
  //   setInterval(updateStats, 3000);
  // }
  //
  // /**
  //  * æ›´æ–°ç«¯å£å·
  //  */
  // updatePort(newPort: string) {
  //   const portNum = parseInt(newPort);
  //   if (portNum > 0 && portNum <= 65535) {
  //     this.port = portNum;
  //     this.errorMessage = '';
  //   } else {
  //     this.errorMessage = 'ç«¯å£å·å¿…é¡»åœ¨1-65535ä¹‹é—´';
  //   }
  // }
  //
  // /**
  //  * æ¸…é™¤æ¶ˆæ¯
  //  */
  // clearMessages() {
  //   this.errorMessage = '';
  //   this.successMessage = '';
  // }
  //
  // build() {
  //   NavDestination() {
  //     Column() {
  //       // æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ
  //       if (this.errorMessage) {
  //         Text(this.errorMessage)
  //           .fontColor(Color.Red)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#ffebee')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       } else if (this.successMessage) {
  //         Text(this.successMessage)
  //           .fontColor(Color.Green)
  //           .fontSize(14)
  //           .margin({ bottom: 10 })
  //           .padding(10)
  //           .backgroundColor('#e8f5e8')
  //           .borderRadius(8)
  //           .width('90%')
  //           .textAlign(TextAlign.Center)
  //       }
  //
  //       // æœåŠ¡å™¨çŠ¶æ€åŒºåŸŸ
  //       if (this.serverInfo) {
  //         Column({ space: 15 }) {
  //           // æœåŠ¡å™¨ä¿¡æ¯å¡ç‰‡
  //           Column({ space: 10 }) {
  //             Row() {
  //               Text('ðŸ“ StaticæœåŠ¡åœ°å€:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(`http://${this.serverInfo.address}:${this.serverInfo.port}`)
  //                 .fontColor(Color.Blue)
  //                 .fontSize(16)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //
  //             Row() {
  //               Text('é™æ€ç›®å½•:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(this.staticExample?.getConfig().staticRoot || '')
  //                 .fontSize(12)
  //                 .fontColor(Color.Gray)
  //                 .maxLines(1)
  //                 .textOverflow({ overflow: TextOverflow.Ellipsis })
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //
  //             Row() {
  //               Text('ç¼“å­˜çŠ¶æ€:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(this.enableCache ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨')
  //                 .fontSize(14)
  //                 .fontColor(this.enableCache ? Color.Green : Color.Orange)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f0f8ff')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // è®¿é—®ç»Ÿè®¡
  //           Column({ space: 10 }) {
  //             Text('ðŸ“Š è®¿é—®ç»Ÿè®¡')
  //               .fontWeight(FontWeight.Bold)
  //               .fontSize(16)
  //
  //             Row() {
  //               Text('æ–‡ä»¶è®¿é—®æ¬¡æ•°:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(120)
  //               Text(this.accessCount.toString())
  //                 .fontColor(Color.Blue)
  //             }
  //             .width('100%')
  //             .justifyContent(FlexAlign.Start)
  //           }
  //           .padding(15)
  //           .backgroundColor('#f9f9f9')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // åœæ­¢æŒ‰é’®
  //           Button('åœæ­¢æœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor(Color.Red)
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.stopServer();
  //             })
  //
  //         }
  //         .width('100%')
  //
  //       } else {
  //         // æœåŠ¡å™¨æœªè¿è¡ŒçŠ¶æ€
  //         Column({ space: 20 }) {
  //           Row() {
  //             Text('ç«¯å£å·:')
  //               .fontWeight(FontWeight.Medium)
  //               .width(80)
  //             TextInput({
  //               text: this.port.toString(),
  //               placeholder: 'è¯·è¾“å…¥ç«¯å£å· (1-65535)'
  //             })
  //               .type(InputType.Number)
  //               .layoutWeight(1)
  //               .height(40)
  //               .onChange((value) => {
  //                 this.updatePort(value);
  //               })
  //           }
  //           .padding(15)
  //           .backgroundColor('#f5f5f5')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // ç¼“å­˜é…ç½®
  //           Row() {
  //             Text('å¯ç”¨ç¼“å­˜:')
  //               .fontWeight(FontWeight.Medium)
  //               .width(80)
  //             Toggle({ type: ToggleType.Switch, isOn: this.enableCache })
  //               .onChange((isOn) => {
  //                 this.enableCache = isOn;
  //               })
  //           }
  //           .padding(15)
  //           .backgroundColor('#f5f5f5')
  //           .borderRadius(10)
  //           .width('90%')
  //
  //           // å¯åŠ¨æŒ‰é’®
  //           Button('å¯åŠ¨æœåŠ¡å™¨')
  //             .width('80%')
  //             .height(50)
  //             .backgroundColor(Color.Blue)
  //             .onClick(() => {
  //               this.clearMessages();
  //               this.startServer();
  //             })
  //         }
  //         .width('100%')
  //       }
  //     }
  //     .width('100%')
  //     .height('100%')
  //     .padding(20)
  //     .justifyContent(FlexAlign.Start)
  //   }
  //   .title(this.title)
  //   .onReady((ctx) => {
  //     if (ctx.pathInfo.param) {
  //       this.title = ctx.pathInfo.param as string;
  //     }
  //   })
  // }
}

