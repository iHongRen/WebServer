// /**
//  * @fileName : RouterExample.ets
//  * @author : @cxy
//  * @date : 2025/10/29
//  * @description : Routerç¤ºä¾‹ - å±•ç¤ºè·¯ç”±ç³»ç»ŸåŠŸèƒ½
//  */
//
// import { fileIo } from '@kit.CoreFileKit';
// import { common } from '@kit.AbilityKit';
// import {
//   HttpServer,
//   ErrorHandler,
//   ServerInfo,
//   ServerEventType,
//   HttpRequest,
//   HttpResponse,
// } from '@cxy/webserver';
//
// /**
//  * è·¯ç”±é…ç½®æ¥å£
//  */
// interface RouterConfig {
//   port: number;
//   staticRoot: string;
//   enableLogging: boolean;
//   enableCors: boolean;
// }
//
// /**
//  * è·¯ç”±è®°å½•æ¥å£
//  */
// interface RouteRecord {
//   id: number;
//   method: string;
//   path: string;
//   pattern: string;
//   params: Record<string, string>;
//   query: Record<string, string>;
//   timestamp: Date;
//   responseTime: number;
//   statusCode: number;
// }
//
// /**
//  * Routerç¤ºä¾‹ç±»
//  * å±•ç¤ºè·¯ç”±ç³»ç»Ÿçš„å„ç§åŠŸèƒ½
//  */
// export class RouterExample {
//   private server: HttpServer | null = null;
//   private serverInfo: ServerInfo | null = null;
//   private isRunning: boolean = false;
//   private config: RouterConfig;
//   private context: common.UIAbilityContext;
//   // è·¯ç”±è®°å½•
//   private routeRecords: RouteRecord[] = [];
//   private nextRouteId: number = 1;
//   // åŠ¨æ€è·¯ç”±å­˜å‚¨
//   private dynamicRoutes: Map<string, any> = new Map();
//
//   constructor(context: common.UIAbilityContext, config?: Partial<RouterConfig>) {
//     this.context = context;
//     this.config = {
//       port: config?.port || 8086,
//       staticRoot: config?.staticRoot || context.filesDir + '/static',
//       enableLogging: config?.enableLogging || true,
//       enableCors: config?.enableCors || true,
//     };
//   }
//
//   /**
//    * è®¾ç½®é™æ€æ–‡ä»¶
//    */
//   public async setupStaticFiles(): Promise<void> {
//     const access = await fileIo.access(this.config.staticRoot);
//     if (!access) {
//       await fileIo.mkdir(this.config.staticRoot);
//     }
//
//     await this.copyStaticFile('router-demo.html');
//     await this.copyStaticFile('route-tester.html');
//   }
//
//   /**
//    * åˆå§‹åŒ–æœåŠ¡å™¨
//    */
//   public initializeServer(): void {
//     this.server = new HttpServer();
//
//     this.setupEventHandling();
//     this.setupMiddleware();
//     this.setupRoutes();
//     this.setupGlobalErrorHandler();
//   }
//
//   /**
//    * å¯åŠ¨æœåŠ¡å™¨
//    */
//   public async start(): Promise<ServerInfo | null> {
//     try {
//       if (!this.server) {
//         this.initializeServer();
//       }
//
//       if (!this.server) {
//         throw new Error('RouteræœåŠ¡å™¨åˆå§‹åŒ–å¤±è´¥');
//       }
//
//       const info = await this.server.startServer(this.config.port);
//
//       if (info.address) {
//         this.serverInfo = info;
//         this.isRunning = true;
//
//         console.log('âœ… RouteræœåŠ¡å™¨å¯åŠ¨æˆåŠŸ!');
//         console.log(`ğŸŒ è®¿é—®åœ°å€: http://${info.address}:${info.port}`);
//         this.printApiEndpoints(info);
//
//         return info;
//       } else {
//         throw new Error('æœªèƒ½è·å–æœåŠ¡å™¨åœ°å€');
//       }
//     } catch (error) {
//       console.error('âŒ å¯åŠ¨RouteræœåŠ¡å™¨å¤±è´¥:', error);
//       this.isRunning = false;
//       return null;
//     }
//   }
//
//   /**
//    * åœæ­¢æœåŠ¡å™¨
//    */
//   public async stop(): Promise<void> {
//     if (this.server && this.isRunning) {
//       await this.server.stopServer();
//       this.isRunning = false;
//       this.serverInfo = null;
//       console.log('ğŸ›‘ RouteræœåŠ¡å™¨å·²åœæ­¢');
//     }
//   }
//
//   // Getteræ–¹æ³•
//   public getServerInfo(): ServerInfo | null {
//     return this.serverInfo;
//   }
//
//   public getIsRunning(): boolean {
//     return this.isRunning;
//   }
//
//   public getConfig(): RouterConfig {
//     return this.config;
//   }
//
//   public getRouteCount(): number {
//     return this.routeRecords.length;
//   }
//
//   /**
//    * å¤åˆ¶é™æ€æ–‡ä»¶
//    */
//   private async copyStaticFile(fileName: string): Promise<void> {
//     try {
//       const buffer = await this.context.resourceManager.getRawFileContent(fileName);
//       const filePath = `${this.config.staticRoot}/${fileName}`;
//
//       const file = await fileIo.open(filePath,
//         fileIo.OpenMode.CREATE | fileIo.OpenMode.WRITE_ONLY | fileIo.OpenMode.TRUNC);
//       await fileIo.write(file.fd, buffer.buffer);
//       await fileIo.close(file.fd);
//     } catch (error) {
//       console.warn(`âš ï¸  æ— æ³•å¤åˆ¶æ–‡ä»¶ ${fileName}:`, error);
//     }
//   }
//
//   /**
//    * è®¾ç½®äº‹ä»¶å¤„ç†
//    */
//   private setupEventHandling(): void {
//     if (!this.server) {
//       return;
//     }
//
//     this.server.onError((error) => {
//       console.error(`ğŸš¨ RouteræœåŠ¡å™¨é”™è¯¯ [${error.type}]: ${JSON.stringify(error.error)}`);
//     });
//
//     this.server.on(ServerEventType.SERVER_STARTED, (event) => {
//       console.log('âœ… RouteræœåŠ¡å™¨å¯åŠ¨æˆåŠŸ:', event.data);
//     });
//   }
//
//   /**
//    * é…ç½®ä¸­é—´ä»¶
//    */
//   private setupMiddleware(): void {
//     if (!this.server) {
//       return;
//     }
//
//     if (this.config.enableLogging) {
//       this.server.logger({
//         format: 'dev',
//         stream: (log: string) => console.log(`ğŸ›£ï¸  ${log}`)
//       });
//     }
//
//     if (this.config.enableCors) {
//       this.server.cors({ origin: '*' });
//     }
//
//     // è·¯ç”±è®°å½•ä¸­é—´ä»¶
//     this.server.use((req, res, next) => {
//       const startTime = Date.now();
//
//       res.onFinish((statusCode) => {
//         const responseTime = Date.now() - startTime;
//
//         const routeRecord: RouteRecord = {
//           id: this.nextRouteId++,
//           method: req.method,
//           path: req.path,
//           pattern: req.url,
//           params: req.params,
//           query: Object.fromEntries(req.query),
//           timestamp: new Date(),
//           responseTime,
//           statusCode
//         };
//
//         this.routeRecords.push(routeRecord);
//
//         // é™åˆ¶è®°å½•æ•°é‡
//         if (this.routeRecords.length > 500) {
//           this.routeRecords = this.routeRecords.slice(-500);
//         }
//       });
//
//       next();
//     });
//
//     this.server.auto();
//     this.server.serveStatic(this.config.staticRoot);
//   }
//
//   /**
//    * é…ç½®è·¯ç”±
//    */
//   private setupRoutes(): void {
//     this.setupBasicRoutes();
//     this.setupParameterRoutes();
//     this.setupWildcardRoutes();
//     this.setupDynamicRoutes();
//     this.setupRouteManagement();
//   }
//
//   /**
//    * åŸºç¡€è·¯ç”±
//    */
//   private setupBasicRoutes(): void {
//     if (!this.server) {
//       return;
//     }
//
//     // æ ¹è·¯å¾„
//     this.server.get('/', (req: HttpRequest, res: HttpResponse) => {
//       res.json({
//         message: 'Routerç¤ºä¾‹é¦–é¡µ',
//         availableRoutes: [
//           'GET /',
//           'GET /about',
//           'GET /contact',
//           'GET /api/users/:id',
//           'GET /api/products/:category/:id',
//           'GET /files/*',
//           'POST /api/routes'
//         ],
//         timestamp: new Date().toISOString()
//       });
//     });
//
//     // å…³äºé¡µé¢
//     this.server.get('/about', (req: HttpRequest, res: HttpResponse) => {
//       res.json({
//         page: 'About',
//         message: 'è¿™æ˜¯å…³äºé¡µé¢',
//         version: '1.0.0',
//         features: ['è·¯ç”±å‚æ•°', 'é€šé…ç¬¦è·¯ç”±', 'åŠ¨æ€è·¯ç”±', 'è·¯ç”±ç»Ÿè®¡']
//       });
//     });
//
//     // è”ç³»é¡µé¢
//     this.server.get('/contact', (req: HttpRequest, res: HttpResponse) => {
//       res.json({
//         page: 'Contact',
//         message: 'è”ç³»æˆ‘ä»¬',
//         email: 'contact@example.com',
//         phone: '+86 123-4567-8900'
//       });
//     });
//   }
//
//   /**
//    * å‚æ•°è·¯ç”±
//    */
//   private setupParameterRoutes(): void {
//     if (!this.server) {
//       return;
//     }
//
//     // å•ä¸ªå‚æ•°
//     this.server.get('/api/users/:id', (req: HttpRequest, res: HttpResponse) => {
//       const userId = req.params['id'];
//
//       res.json({
//         route: '/api/users/:id',
//         userId,
//         userInfo: {
//           id: userId,
//           name: `User ${userId}`,
//           email: `user${userId}@example.com`
//         },
//         params: req.params,
//         query: Object.fromEntries(req.query)
//       });
//     });
//
//     // å¤šä¸ªå‚æ•°
//     this.server.get('/api/products/:category/:id', (req: HttpRequest, res: HttpResponse) => {
//       const { category, id } = req.params;
//
//       res.json({
//         route: '/api/products/:category/:id',
//         category,
//         productId: id,
//         product: {
//           id,
//           name: `Product ${id}`,
//           category,
//           price: Math.floor(Math.random() * 1000) + 100
//         },
//         params: req.params
//       });
//     });
//
//     // å¯é€‰å‚æ•°æ¨¡æ‹Ÿ
//     this.server.get('/api/posts/:id', (req: HttpRequest, res: HttpResponse) => {
//       const postId = req.params['id'];
//       const format = req.query.get('format') || 'json';
//
//       const post = {
//         id: postId,
//         title: `Post ${postId}`,
//         content: `This is the content of post ${postId}`,
//         author: 'Admin',
//         createdAt: new Date().toISOString()
//       };
//
//       if (format === 'xml') {
//         res.setHeader('Content-Type', 'application/xml');
//         res.send(`<?xml version="1.0"?>
// <post>
//   <id>${post.id}</id>
//   <title>${post.title}</title>
//   <content>${post.content}</content>
//   <author>${post.author}</author>
//   <createdAt>${post.createdAt}</createdAt>
// </post>`);
//       } else {
//         res.json(post);
//       }
//     });
//   }
//
//   /**
//    * é€šé…ç¬¦è·¯ç”±
//    */
//   private setupWildcardRoutes(): void {
//     if (!this.server) {
//       return;
//     }
//
//     // æ–‡ä»¶è·¯å¾„é€šé…ç¬¦
//     this.server.get('/files/*', (req: HttpRequest, res: HttpResponse) => {
//       const filePath = req.path.replace('/files/', '');
//
//       res.json({
//         route: '/files/*',
//         requestedFile: filePath,
//         message: `è®¿é—®æ–‡ä»¶: ${filePath}`,
//         fileInfo: {
//           path: filePath,
//           extension: filePath.split('.').pop() || 'unknown',
//           directory: filePath.includes('/') ? filePath.substring(0, filePath.lastIndexOf('/')) : '/',
//           filename: filePath.includes('/') ? filePath.substring(filePath.lastIndexOf('/') + 1) : filePath
//         }
//       });
//     });
//
//     // APIç‰ˆæœ¬é€šé…ç¬¦
//     this.server.get('/api/v*/status', (req: HttpRequest, res: HttpResponse) => {
//       const version = req.path.match(/\/api\/(v\d+)\/status/)?.[1] || 'unknown';
//
//       res.json({
//         route: '/api/v*/status',
//         apiVersion: version,
//         status: 'ok',
//         features: version === 'v1' ? ['basic'] : ['basic', 'advanced', 'premium'],
//         timestamp: new Date().toISOString()
//       });
//     });
//   }
//
//   /**
//    * åŠ¨æ€è·¯ç”±ç®¡ç†
//    */
//   private setupDynamicRoutes(): void {
//     if (!this.server) {
//       return;
//     }
//
//     // åŠ¨æ€è·¯ç”±å¤„ç†å™¨
//     this.server.use((req, res, next) => {
//       const routeKey = `${req.method}:${req.path}`;
//       const dynamicRoute = this.dynamicRoutes.get(routeKey);
//
//       if (dynamicRoute) {
//         res.json({
//           message: 'åŠ¨æ€è·¯ç”±å“åº”',
//           route: req.path,
//           method: req.method,
//           config: dynamicRoute,
//           timestamp: new Date().toISOString()
//         });
//       } else {
//         next();
//       }
//     });
//   }
//
//   /**
//    * è·¯ç”±ç®¡ç†API
//    */
//   private setupRouteManagement(): void {
//     if (!this.server) {
//       return;
//     }
//
//     // è·å–è·¯ç”±ç»Ÿè®¡
//     this.server.get('/api/routes/stats', (req: HttpRequest, res: HttpResponse) => {
//       const stats = this.analyzeRouteStats();
//
//       res.json({
//         totalRequests: this.routeRecords.length,
//         routeStats: stats.routeStats,
//         methodStats: stats.methodStats,
//         averageResponseTime: stats.averageResponseTime,
//         popularRoutes: stats.popularRoutes,
//         recentRequests: this.routeRecords.slice(-10).reverse()
//       });
//     });
//
//     // è·å–è·¯ç”±è®°å½•
//     this.server.get('/api/routes/records', (req: HttpRequest, res: HttpResponse) => {
//       const limit = parseInt(req.query.get('limit') || '50');
//       const offset = parseInt(req.query.get('offset') || '0');
//       const method = req.query.get('method');
//
//       let filteredRecords = this.routeRecords;
//
//       if (method) {
//         filteredRecords = filteredRecords.filter(record => record.method === method);
//       }
//
//       const records = filteredRecords
//         .slice(offset, offset + limit)
//         .reverse();
//
//       res.json({
//         records,
//         total: filteredRecords.length,
//         limit,
//         offset,
//         filters: { method }
//       });
//     });
//
//     // æ·»åŠ åŠ¨æ€è·¯ç”±
//     this.server.post('/api/routes', (req: HttpRequest, res: HttpResponse) => {
//       const { method, path, response } = req.body as any;
//
//       if (!method || !path) {
//         return res.status(400).json({
//           error: 'Method and path are required'
//         });
//       }
//
//       const routeKey = `${method.toUpperCase()}:${path}`;
//       this.dynamicRoutes.set(routeKey, {
//         method: method.toUpperCase(),
//         path,
//         response: response || { message: 'Dynamic route response' },
//         createdAt: new Date().toISOString()
//       });
//
//       res.json({
//         message: 'Dynamic route added',
//         routeKey,
//         totalDynamicRoutes: this.dynamicRoutes.size
//       });
//     });
//
//     // åˆ é™¤åŠ¨æ€è·¯ç”±
//     this.server.delete('/api/routes/:method/:path', (req: HttpRequest, res: HttpResponse) => {
//       const { method, path } = req.params;
//       const routeKey = `${method.toUpperCase()}:/${path}`;
//
//       const deleted = this.dynamicRoutes.delete(routeKey);
//
//       res.json({
//         message: deleted ? 'Dynamic route deleted' : 'Route not found',
//         routeKey,
//         deleted,
//         remainingRoutes: this.dynamicRoutes.size
//       });
//     });
//
//     // è·å–æ‰€æœ‰åŠ¨æ€è·¯ç”±
//     this.server.get('/api/routes/dynamic', (req: HttpRequest, res: HttpResponse) => {
//       const routes = Array.from(this.dynamicRoutes.entries()).map(([key, config]) => ({
//         routeKey: key,
//         ...config
//       }));
//
//       res.json({
//         dynamicRoutes: routes,
//         count: routes.length
//       });
//     });
//
//     // æ¸…é™¤è·¯ç”±è®°å½•
//     this.server.delete('/api/routes/records', (req: HttpRequest, res: HttpResponse) => {
//       const count = this.routeRecords.length;
//       this.routeRecords = [];
//       this.nextRouteId = 1;
//
//       res.json({
//         message: 'Route records cleared',
//         clearedCount: count
//       });
//     });
//   }
//
//   /**
//    * åˆ†æè·¯ç”±ç»Ÿè®¡
//    */
//   private analyzeRouteStats() {
//     const routeStats: Record<string, number> = {};
//     const methodStats: Record<string, number> = {};
//     let totalResponseTime = 0;
//
//     this.routeRecords.forEach(record => {
//       const routeKey = `${record.method} ${record.path}`;
//       routeStats[routeKey] = (routeStats[routeKey] || 0) + 1;
//       methodStats[record.method] = (methodStats[record.method] || 0) + 1;
//       totalResponseTime += record.responseTime;
//     });
//
//     const popularRoutes = Object.entries(routeStats)
//       .sort(([, a], [, b]) => b - a)
//       .slice(0, 5)
//       .map(([route, count]) => ({ route, count }));
//
//     return {
//       routeStats,
//       methodStats,
//       averageResponseTime: this.routeRecords.length > 0 ? totalResponseTime / this.routeRecords.length : 0,
//       popularRoutes
//     };
//   }
//
//   /**
//    * è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†
//    */
//   private setupGlobalErrorHandler(): void {
//     if (!this.server) {
//       return;
//     }
//
//     const errorHandler: ErrorHandler = (error, req, res, next) => {
//       console.error(`ğŸš¨ [Router Error Handler] ${req.method} ${req.path}: ${error.message}`);
//
//       if (res.isHeadersSent()) {
//         return next(error);
//       }
//
//       res.status(500).json({
//         error: 'Router Server Error',
//         message: error.message,
//         route: req.path,
//         method: req.method,
//         timestamp: new Date().toISOString()
//       });
//     };
//
//     this.server.use(errorHandler);
//   }
//
//   /**
//    * æ‰“å°APIç«¯ç‚¹ä¿¡æ¯
//    */
//   private printApiEndpoints(info: ServerInfo): void {
//     const baseUrl = `http://${info.address}:${info.port}`;
//
//     console.log('\nğŸ›£ï¸  Router APIç«¯ç‚¹:');
//     console.log('='.repeat(50));
//
//     console.log('ğŸ“„ æ¼”ç¤ºé¡µé¢:');
//     console.log(`   GET  ${baseUrl}/router-demo.html      - Routeræ¼”ç¤ºé¡µé¢`);
//     console.log(`   GET  ${baseUrl}/route-tester.html     - è·¯ç”±æµ‹è¯•å·¥å…·`);
//
//     console.log('\nğŸ  åŸºç¡€è·¯ç”±:');
//     console.log(`   GET    ${baseUrl}/                    - é¦–é¡µ`);
//     console.log(`   GET    ${baseUrl}/about               - å…³äºé¡µé¢`);
//     console.log(`   GET    ${baseUrl}/contact             - è”ç³»é¡µé¢`);
//
//     console.log('\nğŸ”— å‚æ•°è·¯ç”±:');
//     console.log(`   GET    ${baseUrl}/api/users/:id       - ç”¨æˆ·è¯¦æƒ…`);
//     console.log(`   GET    ${baseUrl}/api/products/:category/:id - äº§å“è¯¦æƒ…`);
//     console.log(`   GET    ${baseUrl}/api/posts/:id       - æ–‡ç« è¯¦æƒ…`);
//
//     console.log('\nğŸŒŸ é€šé…ç¬¦è·¯ç”±:');
//     console.log(`   GET    ${baseUrl}/files/*             - æ–‡ä»¶è®¿é—®`);
//     console.log(`   GET    ${baseUrl}/api/v*/status       - APIç‰ˆæœ¬çŠ¶æ€`);
//
//     console.log('\nâš™ï¸  è·¯ç”±ç®¡ç†:');
//     console.log(`   GET    ${baseUrl}/api/routes/stats    - è·¯ç”±ç»Ÿè®¡`);
//     console.log(`   GET    ${baseUrl}/api/routes/records  - è·¯ç”±è®°å½•`);
//     console.log(`   POST   ${baseUrl}/api/routes          - æ·»åŠ åŠ¨æ€è·¯ç”±`);
//     console.log(`   GET    ${baseUrl}/api/routes/dynamic  - è·å–åŠ¨æ€è·¯ç”±`);
//     console.log(`   DELETE ${baseUrl}/api/routes/records  - æ¸…é™¤è·¯ç”±è®°å½•`);
//
//     console.log('='.repeat(50));
//   }
// }