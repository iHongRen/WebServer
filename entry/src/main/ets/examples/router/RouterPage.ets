import { BusinessError } from '@kit.BasicServicesKit';
import { common } from '@kit.AbilityKit';
import { ServerInfo } from '@cxy/webserver';

// import { RouterExample } from './RouterExample';

@Builder
function routerBuilder() {
  RouterPage()
}

@Component
struct RouterPage {
  build() {

  }

  //   @State title: string = 'Routerç¤ºä¾‹'
  //   @State routerExample: RouterExample | null = null;
  //   @State serverInfo: ServerInfo | null = null;
  //   @State port: number = 8086;
  //   @State errorMessage: string = '';
  //   @State successMessage: string = '';
  //   @State routeCount: number = 0;
  //
  //   aboutToAppear() {
  //     setTimeout(() => {
  //       this.startServer();
  //     }, 0);
  //   }
  //
  //   aboutToDisappear() {
  //     this.stopServer();
  //   }
  //
  //   /**
  //    * åˆå§‹åŒ–Routerç¤ºä¾‹
  //    */
  //   async initializeExample() {
  //     this.errorMessage = '';
  //     const context = this.getUIContext().getHostContext() as common.UIAbilityContext;
  //     this.routerExample = new RouterExample(context, {
  //       port: this.port,
  //       enableLogging: true,
  //       enableCors: true
  //     });
  //     await this.routerExample.setupStaticFiles();
  //   }
  //
  //   /**
  //    * å¯åŠ¨æœåŠ¡å™¨
  //    */
  //   async startServer() {
  //     if (!this.routerExample) {
  //       await this.initializeExample();
  //     }
  //
  //     if (!this.routerExample) {
  //       this.errorMessage = 'RouteræœåŠ¡å™¨åˆå§‹åŒ–å¤±è´¥';
  //       return;
  //     }
  //
  //     try {
  //       this.errorMessage = '';
  //
  //       const info = await this.routerExample.start();
  //
  //       if (info) {
  //         this.serverInfo = info;
  //         this.successMessage = `ðŸ›£ï¸  RouteræœåŠ¡å™¨è¿è¡Œä¸­`;
  //         this.startStatsUpdate();
  //       } else {
  //         this.errorMessage = 'RouteræœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæœªèŽ·å–åˆ°åœ°å€';
  //       }
  //     } catch (error) {
  //       const businessError = error as BusinessError;
  //       this.errorMessage = `å¯åŠ¨å¤±è´¥: ${businessError.message}`;
  //     }
  //   }
  //
  //   /**
  //    * åœæ­¢æœåŠ¡å™¨
  //    */
  //   async stopServer() {
  //     if (!this.routerExample) {
  //       return;
  //     }
  //
  //     try {
  //       await this.routerExample.stop();
  //
  //       this.routerExample = null;
  //       this.serverInfo = null;
  //       this.successMessage = 'ðŸ›£ï¸  RouteræœåŠ¡å™¨å·²åœæ­¢';
  //       this.routeCount = 0;
  //
  //     } catch (error) {
  //       this.errorMessage = `åœæ­¢æœåŠ¡å™¨å¤±è´¥: ${error}`;
  //     }
  //   }
  //
  //   /**
  //    * å¯åŠ¨ç»Ÿè®¡æ•°æ®æ›´æ–°
  //    */
  //   startStatsUpdate() {
  //     const updateStats = () => {
  //       if (this.routerExample) {
  //         this.routeCount = this.routerExample.getRouteCount();
  //       }
  //     };
  //
  //     updateStats();
  //     setInterval(updateStats, 2000);
  //   }
  //
  //   /**
  //    * æ›´æ–°ç«¯å£å·
  //    */
  //   updatePort(newPort: string) {
  //     const portNum = parseInt(newPort);
  //     if (portNum > 0 && portNum <= 65535) {
  //       this.port = portNum;
  //       this.errorMessage = '';
  //     } else {
  //       this.errorMessage = 'ç«¯å£å·å¿…é¡»åœ¨1-65535ä¹‹é—´';
  //     }
  //   }
  //
  //   /**
  //    * æ¸…é™¤æ¶ˆæ¯
  //    */
  //   clearMessages() {
  //     this.errorMessage = '';
  //     this.successMessage = '';
  //   }
  //
  //   build() {
  //     NavDestination() {
  //       Column() {
  //         // æ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ
  //         if (this.errorMessage) {
  //           Text(this.errorMessage)
  //             .fontColor(Color.Red)
  //             .fontSize(14)
  //             .margin({ bottom: 10 })
  //             .padding(10)
  //             .backgroundColor('#ffebee')
  //             .borderRadius(8)
  //             .width('90%')
  //             .textAlign(TextAlign.Center)
  //         } else if (this.successMessage) {
  //           Text(this.successMessage)
  //             .fontColor(Color.Green)
  //             .fontSize(14)
  //             .margin({ bottom: 10 })
  //             .padding(10)
  //             .backgroundColor('#e8f5e8')
  //             .borderRadius(8)
  //             .width('90%')
  //             .textAlign(TextAlign.Center)
  //         }
  //
  //         // æœåŠ¡å™¨çŠ¶æ€åŒºåŸŸ
  //         if (this.serverInfo) {
  //           Column({ space: 15 }) {
  //             // æœåŠ¡å™¨ä¿¡æ¯å¡ç‰‡
  //             Column({ space: 10 }) {
  //               Row() {
  //                 Text('ðŸ›£ï¸  RouteræœåŠ¡åœ°å€:')
  //                   .fontWeight(FontWeight.Medium)
  //                   .width(120)
  //                 Text(`http://${this.serverInfo.address}:${this.serverInfo.port}`)
  //                   .fontColor(Color.Blue)
  //                   .fontSize(16)
  //               }
  //               .width('100%')
  //               .justifyContent(FlexAlign.Start)
  //
  //               Row() {
  //                 Text('æµ‹è¯•å·¥å…·:')
  //                   .fontWeight(FontWeight.Medium)
  //                   .width(120)
  //                 Text(`/route-tester.html`)
  //                   .fontSize(14)
  //                   .fontColor(Color.Blue)
  //               }
  //               .width('100%')
  //               .justifyContent(FlexAlign.Start)
  //             }
  //             .padding(15)
  //             .backgroundColor('#f0f8ff')
  //             .borderRadius(10)
  //             .width('90%')
  //
  //             // è·¯ç”±ç»Ÿè®¡
  //             Column({ space: 10 }) {
  //               Text('ðŸ“Š è·¯ç”±ç»Ÿè®¡')
  //                 .fontWeight(FontWeight.Bold)
  //                 .fontSize(16)
  //                 .margin({ bottom: 5 })
  //
  //               Row() {
  //                 Text('è¯·æ±‚æ¬¡æ•°:')
  //                   .fontWeight(FontWeight.Medium)
  //                   .width(80)
  //                 Text(this.routeCount.toString())
  //                   .fontSize(16)
  //                   .fontColor(Color.Blue)
  //               }
  //               .width('100%')
  //               .justifyContent(FlexAlign.Start)
  //             }
  //             .padding(15)
  //             .backgroundColor('#f0fff0')
  //             .borderRadius(10)
  //             .width('90%')
  //
  //             // è·¯ç”±ç‰¹æ€§
  //             Column({ space: 8 }) {
  //               Text('ðŸ›£ï¸  Routerç‰¹æ€§')
  //                 .fontWeight(FontWeight.Bold)
  //                 .fontSize(16)
  //                 .margin({ bottom: 5 })
  //
  //               Text('âœ… å‚æ•°è·¯ç”± (/users/:id)')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //               Text('âœ… é€šé…ç¬¦è·¯ç”± (/files/*)')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //               Text('âœ… åŠ¨æ€è·¯ç”±ç®¡ç†')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //               Text('âœ… è·¯ç”±ç»Ÿè®¡åˆ†æž')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //               Text('âœ… è¯·æ±‚è®°å½•è·Ÿè¸ª')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //               Text('âœ… è·¯ç”±æ€§èƒ½ç›‘æŽ§')
  //                 .fontSize(12)
  //                 .fontColor('#666')
  //             }
  //             .alignItems(HorizontalAlign.Start)
  //             .padding(15)
  //             .backgroundColor('#fff3e0')
  //             .borderRadius(10)
  //             .width('90%')
  //
  //             // åœæ­¢æŒ‰é’®
  //             Button('åœæ­¢RouteræœåŠ¡å™¨')
  //               .width('80%')
  //               .height(50)
  //               .backgroundColor('#d32f2f')
  //               .onClick(() => {
  //                 this.clearMessages();
  //                 this.stopServer();
  //               })
  //           }
  //           .width('100%')
  //
  //         } else {
  //           // æœåŠ¡å™¨æœªè¿è¡ŒçŠ¶æ€
  //           Column({ space: 20 }) {
  //             // é…ç½®åŒºåŸŸ
  //             Row() {
  //               Text('ç«¯å£å·:')
  //                 .fontWeight(FontWeight.Medium)
  //                 .width(80)
  //               TextInput({
  //                 text: this.port.toString(),
  //                 placeholder: 'è¯·è¾“å…¥ç«¯å£å· (1-65535)'
  //               })
  //                 .type(InputType.Number)
  //                 .layoutWeight(1)
  //                 .height(40)
  //                 .onChange((value) => {
  //                   this.updatePort(value);
  //                 })
  //             }
  //             .padding(15)
  //             .backgroundColor('#f5f5f5')
  //             .borderRadius(10)
  //             .width('90%')
  //
  //             // åŠŸèƒ½è¯´æ˜Ž
  //             Column({ space: 8 }) {
  //               Text('ðŸ›£ï¸  RouteråŠŸèƒ½')
  //                 .fontWeight(FontWeight.Bold)
  //                 .fontSize(16)
  //                 .margin({ bottom: 5 })
  //
  //               Text('ðŸ”— åŠ¨æ€è·¯ç”±ç®¡ç†')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //               Text('ðŸ“‹ è·¯ç”±å‚æ•°è§£æž')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //               Text('ðŸŒŸ é€šé…ç¬¦è·¯ç”±æ”¯æŒ')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //               Text('ðŸ“Š è·¯ç”±ç»Ÿè®¡åˆ†æž')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //               Text('ðŸ§ª è·¯ç”±æµ‹è¯•å·¥å…·')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //               Text('âš¡ è·¯ç”±æ€§èƒ½ç›‘æŽ§')
  //                 .fontSize(14)
  //                 .fontColor('#666')
  //             }
  //             .alignItems(HorizontalAlign.Start)
  //             .padding(15)
  //             .backgroundColor('#e3f2fd')
  //             .borderRadius(10)
  //             .width('90%')
  //
  //             // å¯åŠ¨æŒ‰é’®
  //             Button('å¯åŠ¨RouteræœåŠ¡å™¨')
  //               .width('80%')
  //               .height(50)
  //               .backgroundColor('#1976d2')
  //               .onClick(() => {
  //                 this.clearMessages();
  //                 this.startServer();
  //               })
  //           }
  //           .width('100%')
  //         }
  //       }
  //       .width('100%')
  //       .height('100%')
  //       .padding(20)
  //       .justifyContent(FlexAlign.Start)
  //     }
  //     .title(this.title)
  //     .onReady((ctx) => {
  //       if (ctx.pathInfo.param) {
  //         this.title = ctx.pathInfo.param as string;
  //       }
  //     })
  //   }
  // }

}